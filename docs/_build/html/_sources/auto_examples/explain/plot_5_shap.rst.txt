
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples\explain\plot_5_shap.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_explain_plot_5_shap.py>`
        to download the full example code or to run this example in your browser via Binder

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_explain_plot_5_shap.py:


SHAP:  Classification
=====================================

SHAP plots on classification problem

.. GENERATED FROM PYTHON SOURCE LINES 10-18

.. code-block:: default

    from piml import Experiment
    from piml.models import ReluDNNClassifier
    exp = Experiment()
    exp.data_loader(data='TaiwanCredit')
    exp.data_summary(feature_exclude=["LIMIT_BAL", "SEX", "EDUCATION", "MARRIAGE", "AGE"], feature_type={})
    exp.data_prepare(target='FlagDefault', task_type='Classification', test_ratio=0.2, random_state=0)
    classifier = ReluDNNClassifier(hidden_layer_sizes=(20, 20), l1_reg=0.0008, batch_size=500, learning_rate=0.001)
    exp.model_train(model=classifier, name='ReLU-DNN')




.. rst-class:: sphx-glr-script-out

 .. code-block:: none

           LIMIT_BAL  SEX  EDUCATION  MARRIAGE   AGE  PAY_1  PAY_2  PAY_3  PAY_4  \
    0        20000.0  2.0        2.0       1.0  24.0    2.0    2.0   -1.0   -1.0   
    1       120000.0  2.0        2.0       2.0  26.0   -1.0    2.0    0.0    0.0   
    2        90000.0  2.0        2.0       2.0  34.0    0.0    0.0    0.0    0.0   
    3        50000.0  2.0        2.0       1.0  37.0    0.0    0.0    0.0    0.0   
    4        50000.0  1.0        2.0       1.0  57.0   -1.0    0.0   -1.0    0.0   
    ...          ...  ...        ...       ...   ...    ...    ...    ...    ...   
    29995   220000.0  1.0        3.0       1.0  39.0    0.0    0.0    0.0    0.0   
    29996   150000.0  1.0        3.0       2.0  43.0   -1.0   -1.0   -1.0   -1.0   
    29997    30000.0  1.0        2.0       2.0  37.0    4.0    3.0    2.0   -1.0   
    29998    80000.0  1.0        3.0       1.0  41.0    1.0   -1.0    0.0    0.0   
    29999    50000.0  1.0        2.0       1.0  46.0    0.0    0.0    0.0    0.0   

           PAY_5  PAY_6  BILL_AMT1  BILL_AMT2  BILL_AMT3  BILL_AMT4  BILL_AMT5  \
    0        0.0    0.0   3.592621   3.491782   2.838849   0.000000   0.000000   
    1        0.0    2.0   3.428621   3.237041   3.428621   3.514946   3.538574   
    2        0.0    0.0   4.465977   4.146996   4.132260   4.156307   4.174612   
    3        0.0    0.0   4.672015   4.683353   4.692776   4.452016   4.461799   
    4        0.0    0.0   3.935406   3.753660   4.554319   4.320997   4.282101   
    ...      ...    ...        ...        ...        ...        ...        ...   
    29995    0.0    0.0   5.276345   5.285143   5.318827   4.944507   4.494683   
    29996    0.0    0.0   3.226342   3.262214   3.544440   3.953276   3.715251   
    29997    0.0    0.0   3.552181   3.525951   3.440752   4.319710   4.313509   
    29998    0.0   -1.0  -3.216430   4.894205   4.882553   4.722428   4.073938   
    29999    0.0    0.0   4.680607   4.689362   4.696924   4.562721   4.510933   

           BILL_AMT6  PAY_AMT1  PAY_AMT2  PAY_AMT3  PAY_AMT4  PAY_AMT5  PAY_AMT6  \
    0       0.000000  0.000000  2.838849  0.000000  0.000000  0.000000  0.000000   
    1       3.513484  0.000000  3.000434  3.000434  3.000434  0.000000  3.301247   
    2       4.191731  3.181558  3.176381  3.000434  3.000434  3.000434  3.699057   
    3       4.470528  3.301247  3.305351  3.079543  3.041787  3.029384  3.000434   
    4       4.281760  3.301247  4.564453  4.000043  3.954291  2.838849  2.832509   
    ...          ...       ...       ...       ...       ...       ...       ...   
    29995   4.203604  3.929470  4.301052  3.699317  3.484015  3.699057  3.000434   
    29996   0.000000  3.264345  3.547405  3.954194  2.113943  0.000000  0.000000   
    29997   4.286861  0.000000  0.000000  4.342442  3.623353  3.301247  3.491502   
    29998   4.689708  4.933998  3.532754  3.071514  3.284882  4.723989  3.256477   
    29999   4.185089  3.317854  3.255514  3.155640  3.000434  3.000434  3.000434   

           FlagDefault  
    0              1.0  
    1              1.0  
    2              0.0  
    3              0.0  
    4              0.0  
    ...            ...  
    29995          0.0  
    29996          0.0  
    29997          1.0  
    29998          1.0  
    29999          1.0  

    [30000 rows x 24 columns]
             name  n_missing      mean       std       min        q1    median  \
    2       PAY_1        0.0  0.167233  0.931323 -1.000000  0.000000  0.000000   
    3       PAY_2        0.0  0.118367  0.965844 -1.000000  0.000000  0.000000   
    4       PAY_3        0.0  0.106133  0.950876 -1.000000  0.000000  0.000000   
    5       PAY_4        0.0  0.069200  0.911613 -1.000000  0.000000  0.000000   
    6       PAY_5        0.0  0.036867  0.864561 -1.000000  0.000000  0.000000   
    7       PAY_6        0.0  0.035233  0.867919 -1.000000  0.000000  0.000000   
    8   BILL_AMT1        0.0  3.885958  1.547037 -5.219010  3.551419  4.349909   
    9   BILL_AMT2        0.0  3.795420  1.654534 -4.843718  3.475053  4.326357   
    10  BILL_AMT3        0.0  3.739384  1.696840 -5.196632  3.426064  4.302969   
    11  BILL_AMT4        0.0  3.670062  1.733904 -5.230452  3.366936  4.279964   
    12  BILL_AMT5        0.0  3.599323  1.762540 -4.910277  3.246499  4.257811   
    13  BILL_AMT6        0.0  3.507501  1.833062 -5.530973  3.099335  4.232285   
    14   PAY_AMT1        0.0  2.879374  1.411589  0.000000  3.000434  3.322426   
    15   PAY_AMT2        0.0  2.850124  1.423945  0.000000  2.921166  3.303196   
    16   PAY_AMT3        0.0  2.728754  1.454766  0.000000  2.592177  3.255514   
    17   PAY_AMT4        0.0  2.639519  1.475124  0.000000  2.472756  3.176381   
    18   PAY_AMT5        0.0  2.619748  1.495708  0.000000  2.403976  3.176381   
    19   PAY_AMT6        0.0  2.576596  1.532231  0.000000  2.074631  3.176381   

              q3       max  
    2   0.000000  8.000000  
    3   0.000000  8.000000  
    4   0.000000  8.000000  
    5   0.000000  8.000000  
    6   0.000000  8.000000  
    7   0.000000  8.000000  
    8   4.826671  5.984308  
    9   4.806229  5.992965  
    10  4.779349  6.221177  
    11  4.736452  5.950164  
    12  4.700630  5.967160  
    13  4.691958  5.983024  
    14  3.699578  5.941289  
    15  3.699057  6.226409  
    16  3.653791  5.952328  
    17  3.603604  5.793092  
    18  3.605574  5.629950  
    19  3.602169  5.723182  
              name  n_missing  n_unique         top1        top2 top3  n_others
    3  FlagDefault          0         2  0.0 : 23364  1.0 : 6636    0         0
    HTML(value='Data Shape:(30000, 24)')
    Tab(children=(Output(), Output()), layout=Layout(height='350px'), _titles={'0': 'Numerical Attributes', '1': 'Categorical Attributes'})
                      0                                           1
    0  Excluded columns  [SEX, EDUCATION, MARRIAGE, AGE, LIMIT_BAL]
    1   Target variable                                 FlagDefault
    2     Sample weight                                        None
    3         Task type                              Classification
    4      Split method                                      Random
    5        Test ratio                                         0.2
    6      Random state                                           0
    HTML(value="<p class='notification info'>Register ReLU-DNN Done</p>")




.. GENERATED FROM PYTHON SOURCE LINES 19-20

Plot SHAP 

.. GENERATED FROM PYTHON SOURCE LINES 20-21

.. code-block:: default

    exp.model_explain(model='ReLU-DNN', show='shap_waterfall')



.. image-sg:: /auto_examples/explain/images/sphx_glr_plot_5_shap_001.png
   :alt: plot 5 shap
   :srcset: /auto_examples/explain/images/sphx_glr_plot_5_shap_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 22-23

.. code-block:: default

    exp.model_explain(model='ReLU-DNN', show='shap_fi', sample_size=10)



.. image-sg:: /auto_examples/explain/images/sphx_glr_plot_5_shap_002.png
   :alt: plot 5 shap
   :srcset: /auto_examples/explain/images/sphx_glr_plot_5_shap_002.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|                                                                                           | 0/10 [00:00<?, ?it/s]     10%|########3                                                                          | 1/10 [00:03<00:27,  3.10s/it]     20%|################6                                                                  | 2/10 [00:06<00:24,  3.07s/it]     30%|########################9                                                          | 3/10 [00:09<00:21,  3.08s/it]     40%|#################################2                                                 | 4/10 [00:12<00:18,  3.11s/it]     50%|#########################################5                                         | 5/10 [00:15<00:15,  3.17s/it]     60%|#################################################8                                 | 6/10 [00:19<00:12,  3.22s/it]     70%|##########################################################1                        | 7/10 [00:22<00:09,  3.28s/it]     80%|##################################################################4                | 8/10 [00:25<00:06,  3.31s/it]     90%|##########################################################################7        | 9/10 [00:29<00:03,  3.35s/it]    100%|##################################################################################| 10/10 [00:32<00:00,  3.38s/it]    100%|##################################################################################| 10/10 [00:32<00:00,  3.27s/it]




.. GENERATED FROM PYTHON SOURCE LINES 24-25

.. code-block:: default

    exp.model_explain(model='ReLU-DNN', show='shap_summary', sample_size=10)



.. image-sg:: /auto_examples/explain/images/sphx_glr_plot_5_shap_003.png
   :alt: plot 5 shap
   :srcset: /auto_examples/explain/images/sphx_glr_plot_5_shap_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|                                                                                           | 0/10 [00:00<?, ?it/s]     10%|########3                                                                          | 1/10 [00:03<00:33,  3.73s/it]     20%|################6                                                                  | 2/10 [00:06<00:26,  3.37s/it]     30%|########################9                                                          | 3/10 [00:10<00:23,  3.31s/it]     40%|#################################2                                                 | 4/10 [00:13<00:19,  3.27s/it]     50%|#########################################5                                         | 5/10 [00:16<00:16,  3.28s/it]     60%|#################################################8                                 | 6/10 [00:20<00:13,  3.37s/it]     70%|##########################################################1                        | 7/10 [00:23<00:10,  3.43s/it]     80%|##################################################################4                | 8/10 [00:27<00:06,  3.47s/it]     90%|##########################################################################7        | 9/10 [00:30<00:03,  3.40s/it]    100%|##################################################################################| 10/10 [00:33<00:00,  3.31s/it]    100%|##################################################################################| 10/10 [00:33<00:00,  3.36s/it]




.. GENERATED FROM PYTHON SOURCE LINES 26-27

.. code-block:: default

    exp.model_explain(model='ReLU-DNN', uni_feature='BILL_AMT1', show='shap_scatter', sample_size=10)



.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /auto_examples/explain/images/sphx_glr_plot_5_shap_004.png
         :alt: plot 5 shap
         :srcset: /auto_examples/explain/images/sphx_glr_plot_5_shap_004.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/explain/images/sphx_glr_plot_5_shap_005.png
         :alt: plot 5 shap
         :srcset: /auto_examples/explain/images/sphx_glr_plot_5_shap_005.png
         :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|                                                                                           | 0/10 [00:00<?, ?it/s]     10%|########3                                                                          | 1/10 [00:03<00:28,  3.13s/it]     20%|################6                                                                  | 2/10 [00:06<00:25,  3.13s/it]     30%|########################9                                                          | 3/10 [00:09<00:22,  3.16s/it]     40%|#################################2                                                 | 4/10 [00:12<00:19,  3.20s/it]     50%|#########################################5                                         | 5/10 [00:15<00:16,  3.22s/it]     60%|#################################################8                                 | 6/10 [00:19<00:13,  3.27s/it]     70%|##########################################################1                        | 7/10 [00:22<00:09,  3.30s/it]     80%|##################################################################4                | 8/10 [00:26<00:06,  3.40s/it]     90%|##########################################################################7        | 9/10 [00:29<00:03,  3.33s/it]    100%|##################################################################################| 10/10 [00:32<00:00,  3.26s/it]    100%|##################################################################################| 10/10 [00:32<00:00,  3.26s/it]





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 2 minutes  31.968 seconds)

**Estimated memory usage:**  347 MB


.. _sphx_glr_download_auto_examples_explain_plot_5_shap.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: binder-badge

      .. image:: images/binder_badge_logo.svg
        :target: https://mybinder.org/v2/gh/selfexplainml/piml-toolbox/main?urlpath=lab/tree/./docs/_build/html/notebooks/auto_examples/explain/plot_5_shap.ipynb
        :alt: Launch binder
        :width: 150 px

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_5_shap.py <plot_5_shap.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_5_shap.ipynb <plot_5_shap.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
