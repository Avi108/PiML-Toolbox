<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>

  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>PiML Toolbox</title>
  

  
  <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  <link rel="stylesheet" href="../../_static/css/vendor/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>

</head>

<body class="wy-body-for-nav">

  


<nav id="navbar" class="sk-docs-navbar navbar navbar-expand-md navbar-light bg-light py-0">
  <div class="container-fluid sk-docs-container px-0">
      <a class="navbar-brand py-0" href="../../index.html">
        <img
          class="sk-brand-img"
          src="../../_static/piml-logo.png"
          alt="logo"/>
      </a>
    <button
      id="sk-navbar-toggler"
      class="navbar-toggler"
      type="button"
      data-toggle="collapse"
      data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="sk-navbar-collapse collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../install.html">Install</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../user_guide.html">User Guide</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../modules/classes.html">API</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../auto_examples/index.html">Examples</a>
        </li>
     </ul>
      <div id="searchbox" role="search">
          <div class="searchformwrapper">
          <form class="search" action="../../search.html" method="get">
            <input class="sk-search-text-input" type="text" name="q" aria-labelledby="searchlabel" />
            <input class="sk-search-text-btn" type="submit" value="Go" />
          </form>
          </div>
      </div>
    </div>
  </div>
</nav>
  <div class="d-flex" id="sk-doc-wrapper">
      <input type="checkbox" name="sk-toggle-checkbox" id="sk-toggle-checkbox">
      <label id="sk-sidemenu-toggle" class="sk-btn-toggle-toc btn sk-btn-primary" for="sk-toggle-checkbox">Toggle Menu</label>
      <div id="sk-sidebar-wrapper" class="border-right">
        <div class="sk-sidebar-toc-wrapper">
          <div class="sk-sidebar-toc-logo">
            <a href="../../index.html">
              <img
                class="sk-brand-img"
                src="../../_static/piml-logo.png"
                alt="logo"/>
            </a>
          </div>
          <!--div class="btn-group w-100 mb-2" role="group" aria-label="rellinks">
              <a href="robustness.html" role="button" class="btn sk-btn-rellink py-1" sk-rellink-tooltip="6.5. Robustness">Prev</a><a href="../testing.html" role="button" class="btn sk-btn-rellink py-1" sk-rellink-tooltip="6. Diagnostic Suite">Up</a>
              <a href="fairness.html" role="button" class="btn sk-btn-rellink py-1" sk-rellink-tooltip="6.7. Fairness">Next</a>
          </div-->
              <div class="sk-sidebar-toc">
              
                <ul>
                
                
                
                
                
                
                <li>
                  <a href="../../user_guide.html" class="sk-toc-active">User Guide</a>
                </li>
                <ul>
                
                  <li>
                    <a href="../introduction.html" class="">1. Introduction</a>
                    
                  </li>
                
                  <li>
                    <a href="../data.html" class="">2. Data Pipeline</a>
                    
                  </li>
                
                  <li>
                    <a href="../extmodels.html" class="">3. Black-box Models</a>
                    
                  </li>
                
                  <li>
                    <a href="../explainability.html" class="">4. Post-hoc Explainability</a>
                    
                  </li>
                
                  <li>
                    <a href="../models.html" class="">5. Interpretable Models</a>
                    
                  </li>
                
                  <li>
                    <a href="../testing.html" class="sk-toc-active">6. Diagnostic Suite</a>
                    
                    <ul>
                      
                        <li class="sk-toctree-l3">
                          <a href="accuracy.html">6.1. Accuracy</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="weakspot.html">6.2. WeakSpot</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="overfit.html">6.3. Overfit</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="reliability.html">6.4. Reliability</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="robustness.html">6.5. Robustness</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="">6.6. Resilience</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="fairness.html">6.7. Fairness</a>
                        </li>
                      
                    </ul>
                    
                  </li>
                
                  <li>
                    <a href="../comparison.html" class="">7. Model Comparison</a>
                    
                  </li>
                
                  <li>
                    <a href="../cases.html" class="">8. Case Studies</a>
                    
                  </li>
                
                </ul>
                
                
                
                
                </ul>
              </div>
        </div>
      </div>
      <div id="sk-page-content-wrapper">
        <div class="sk-page-content container-fluid body px-md-3" role="main">
          
  <style type="text/css">
  div.body div.toctree-wrapper ul {
      padding-left: 0;
  }

  div.body li.toctree-l1 {
      padding: 0 0 0.5em 0;
      list-style-type: none;
      font-size: 150%;
      font-weight: bold;
  }

  div.body li.toctree-l2 {
      font-size: 70%;
      list-style-type: square;
      font-weight: normal;
      margin-left: 40px;
  }

  div.body li.toctree-l3 {
      font-size: 85%;
      list-style-type: circle;
      font-weight: normal;
      margin-left: 40px;
  }

  div.body li.toctree-l4 {
      margin-left: 40px;
  }

</style><section id="resilience">
<h1><span class="section-number">6.6. </span>Resilience<a class="headerlink" href="#resilience" title="Permalink to this heading">Â¶</a></h1>
<p>Resilience test is designed to measure a modelâs ability to maintain its performance when the distribution of inputs changes. This testing is essential to ensure that a model can handle unexpected scenarios that may differ from the data it was trained on. Additionally, resilience testing can also help identify areas where a model can be improved. In PiML, we offer various out-of-distribution scenarios to evaluate a modelâs resilience, providing insight into its robustness in challenging situations.</p>
<section id="algorithm-details">
<h2><span class="section-number">6.6.1. </span>Algorithm Details<a class="headerlink" href="#algorithm-details" title="Permalink to this heading">Â¶</a></h2>
<p>We have implemented four out-of-distribution scenarios, as follows.</p>
<p><strong>Worst sample</strong>: Selects the worst samples according to the error of each sample. That is, we calculate the residual of each test set sample (use predicted probability for binary classification as metric is âAUCâ or âF1â), and then sort them in the descending order of absoluate residuals. The samples with the largest residuals are selected as the worst samples. Note that the worst samples are related to the model being tested, and they can be very different for different models.</p>
<p><strong>Hard sample</strong>: Instead of directly selects the worst sample using the residuals, this method uses a surrogate model to rank the hardness of samples, i.e., the likelihood of having bad performance. In particular, we do the following</p>
<ul class="simple">
<li><p>Fit a complicated XGB model (XGB-A) on the training data;</p></li>
<li><p>Evaluate its performance of model XGB-A and find the worst 30% test samples;</p></li>
<li><p>Mark the worst test samples as 1, and the rest test samples as 0;</p></li>
<li><p>Fit another XGB Classifier (XGB-B) using the data created in the step.</p></li>
<li><p>Use XGB-B as a surrogate to rank the hardness of samples (samples with large predicted probability are hard samples).</p></li>
</ul>
<p>Note that in this scenario, the worst samples are the same across different models.</p>
<p><strong>Outer sample</strong>: Use the Euclidean distance of each test sample to the mean of features in the training set as a surrogate of worstness. Samples with large distance would be marked as outer samples. Note that the outer samples are model agnostic, and the worst samples are the same across different models.</p>
<p><strong>Worst cluster</strong>: Fit a K-means (<span class="math notranslate nohighlight">\(K=2,\ldots,10\)</span>) clustering algorithm using the features of training data, and then select the worst performing cluster in the test set as the worst samples. Note that the worst samples are related to models.</p>
<p>In addition to these four scenarios, we also provide an option to select worst samples by conditioning on one immutable feature. That is done by performing equal-quantile binning on the immutable feature, and then selecting the worst samples in each slice. This is useful when we want to control the effect of one feature.</p>
</section>
<section id="usage">
<h2><span class="section-number">6.6.2. </span>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">Â¶</a></h2>
<p>Resilience test can be run by using <code class="docutils literal notranslate"><span class="pre">model_diagnose</span></code>. In total, we have 4 different plots for resilience test, including âresilience_perfâ, âresilience_distanceâ, âresilience_shift_densityâ, and âresilience_shift_histogramâ. For demonstration purposes, we will train a XGB2 model using the TaiwanCredit data.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">resilience_method</span></code>: The method to select worst samples. It can be one of âworst-sampleâ, âhard-sampleâ, âouter-sampleâ, and âworst-clusterâ. The default is âworst-sampleâ.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">immu_feature</span></code>: The immutable feature to condition on when selecting worst samples. The default is None.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metric</span></code>: The performance metric to be used. Supported metrics are âACCâ, âAUCâ, and âF1â for binary classification; âMSEâ, âMAEâ, and âR2â for regression.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">distance_metrics</span></code>: The distance metric for comparing the worst test sample and full test sample; available options includes âPSIâ, âWD1â, and âKSâ, and the details can be found <a class="reference external" href="reliability.html#distance-of-reliable-and-un-reliable-data">here</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code>: The worst-sample ratio to be used as <code class="docutils literal notranslate"><span class="pre">resilience_method</span></code> is âworst-sampleâ, âhard-sampleâ, or âouter-sampleâ, which can be 0.1, 0.2, â¦, 1.0. Used when <code class="docutils literal notranslate"><span class="pre">show</span></code> is âresilience_distanceâ, âresilience_shift_densityâ, or âresilience_shift_histogramâ.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_clusters</span></code>: The number of clusters to be used as <code class="docutils literal notranslate"><span class="pre">resilience_method</span></code> is âworst-clusterâ, available values are 1, 2, â¦, 10. Used when <code class="docutils literal notranslate"><span class="pre">show</span></code> is âresilience_distanceâ, âresilience_shift_densityâ, or âresilience_shift_histogramâ.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">psi_buckets</span></code>: The binning method for calculating the PSI value.</p></li>
</ul>
<section id="resilience-performance">
<h3><span class="section-number">6.6.2.1. </span>Resilience Performance<a class="headerlink" href="#resilience-performance" title="Permalink to this heading">Â¶</a></h3>
<p>Using resilience test, you can check the worst sample performance of a model under different out-distribution scenarios. The keyword for this plot is âresilience_perfâ.</p>
<p><strong>worst-sample</strong></p>
<p>The example below illustrates the performance of the model in the âworst-sampleâ scenario, as the worst sample ratios vary from 0.1 to 1.0. A ratio of 1.0 indicates that all test samples are treated as worst samples, while a ratio of 0.1 means only 10% of the test samples are treated as worst samples. The red dotted line represents the modelâs performance on the overall test sample, which is equivalent to the performance at a worst ratio of 1.0. The curve is mostly monotonic, indicating that as the worst sample ratio increases, the modelâs performance decreases.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_diagnose</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;resilience_perf&quot;</span><span class="p">,</span> <span class="n">resilience_method</span><span class="o">=</span><span class="s2">&quot;worst-sample&quot;</span><span class="p">,</span>
              <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;AUC&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/testing/plot_5_resilience_cls.html"><img alt="../../_images/sphx_glr_plot_5_resilience_cls_001.png" src="../../_images/sphx_glr_plot_5_resilience_cls_001.png" /></a>
</figure>
<p><strong>hard-sample</strong></p>
<p>When the worst sample ratio is less than 0.4, the AUC values are approximately 0.5, which suggests that the modelâs performance is akin to that of a random classifier. As the worst sample ratio increases, the modelâs performance steadily improves.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_diagnose</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;resilience_perf&quot;</span><span class="p">,</span> <span class="n">resilience_method</span><span class="o">=</span><span class="s2">&quot;hard-sample&quot;</span><span class="p">,</span>
              <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;AUC&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/testing/plot_5_resilience_cls.html"><img alt="../../_images/sphx_glr_plot_5_resilience_cls_002.png" src="../../_images/sphx_glr_plot_5_resilience_cls_002.png" /></a>
</figure>
<p><strong>outer-sample</strong></p>
<p>Based on the plot below, it appears that even in the worst-10% test sample scenario, the modelâs performance is relatively good, with an AUC above 0.7. The performance peaks at a worst sample ratio of around 0.7 and then begins to decline. This may be because the scenario is unsupervised, and the samples identified as âworstâ may not necessarily be the worst in all cases. In some instances, the âworst samplesâ may actually have better performance than the full test samples.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_diagnose</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;resilience_perf&quot;</span><span class="p">,</span> <span class="n">resilience_method</span><span class="o">=</span><span class="s2">&quot;outer-sample&quot;</span><span class="p">,</span>
              <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;AUC&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/testing/plot_5_resilience_cls.html"><img alt="../../_images/sphx_glr_plot_5_resilience_cls_003.png" src="../../_images/sphx_glr_plot_5_resilience_cls_003.png" /></a>
</figure>
<p><strong>worst-cluster</strong></p>
<p>The last approach is the âworst-clusterâ method, which differs slightly from the previous three methods. In this approach, the x-axis of the plot represents the number of clusters, which ranges from 1 to 10. This involves varying the value of  <span class="math notranslate nohighlight">\(K\)</span> in KMeans and identifying the worst cluster as the worst samples. The worst cluster is defined as the cluster with the lowest performance metric. Notably, <span class="math notranslate nohighlight">\(K=1\)</span> represents the entire test sample. As this is also an unsupervised method, the performance may not be monotonic as the number of clusters increases.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_diagnose</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;resilience_perf&quot;</span><span class="p">,</span> <span class="n">resilience_method</span><span class="o">=</span><span class="s2">&quot;worst-cluster&quot;</span><span class="p">,</span>
              <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;AUC&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/testing/plot_5_resilience_cls.html"><img alt="../../_images/sphx_glr_plot_5_resilience_cls_004.png" src="../../_images/sphx_glr_plot_5_resilience_cls_004.png" /></a>
</figure>
</section>
<section id="resilience-distance">
<h3><span class="section-number">6.6.2.2. </span>Resilience Distance<a class="headerlink" href="#resilience-distance" title="Permalink to this heading">Â¶</a></h3>
<p>By setting <code class="docutils literal notranslate"><span class="pre">show</span></code> to âresilience_distanceâ, the distributional distance between the worst test sample and full test sample will be calculated for each feature. Then the features will be ranked by the distance, and the top-10 features with the largest distances will be displayed.</p>
<p>In the first example, we set the <code class="docutils literal notranslate"><span class="pre">distance_metrics</span></code> to âPSIâ, and you can also use âWD1â and âKSâ instead. The worst sample ratio <code class="docutils literal notranslate"><span class="pre">alpha</span></code> is set to 0.3. The plot suggests the variable <code class="docutils literal notranslate"><span class="pre">Pay_1</span></code> has the largest PSI (around 0.55), whihc is usually thought as a significant distribution change.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_diagnose</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;resilience_distance&quot;</span><span class="p">,</span> <span class="n">resilience_method</span><span class="o">=</span><span class="s2">&quot;worst-sample&quot;</span><span class="p">,</span>
                   <span class="n">distance_metric</span><span class="o">=</span><span class="s2">&quot;PSI&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/testing/plot_5_resilience_cls.html"><img alt="../../_images/sphx_glr_plot_5_resilience_cls_005.png" src="../../_images/sphx_glr_plot_5_resilience_cls_005.png" /></a>
</figure>
<p>In the second example, we still use the same setting, but with <code class="docutils literal notranslate"><span class="pre">immu_feature</span></code> not None. By conditioning on  <code class="docutils literal notranslate"><span class="pre">PAY_1</span></code>, we recalculate the resilience distance. It can be found that the PSI distance of that immutable feature becomes much smaller.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_diagnose</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;resilience_distance&quot;</span><span class="p">,</span> <span class="n">resilience_method</span><span class="o">=</span><span class="s2">&quot;worst-sample&quot;</span><span class="p">,</span>
                   <span class="n">distance_metric</span><span class="o">=</span><span class="s2">&quot;PSI&quot;</span><span class="p">,</span> <span class="n">immu_feature</span><span class="o">=</span><span class="s2">&quot;PAY_1&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/testing/plot_5_resilience_cls.html"><img alt="../../_images/sphx_glr_plot_5_resilience_cls_006.png" src="../../_images/sphx_glr_plot_5_resilience_cls_006.png" /></a>
</figure>
<p>The third example shows the resilience distance plot for the âworst-clusterâ scenario. The <code class="docutils literal notranslate"><span class="pre">n_clusters</span></code> is set to 10, and the <code class="docutils literal notranslate"><span class="pre">distance_metrics</span></code> is set to âWD1â. The plot suggests the variable <code class="docutils literal notranslate"><span class="pre">Pay_1</span></code> has the largest WD1 (0.12), which is usually thought as a moderate distribution change.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_diagnose</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;resilience_distance&quot;</span><span class="p">,</span> <span class="n">resilience_method</span><span class="o">=</span><span class="s2">&quot;worst-cluster&quot;</span><span class="p">,</span>
                   <span class="n">distance_metric</span><span class="o">=</span><span class="s2">&quot;WD1&quot;</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/testing/plot_5_resilience_cls.html"><img alt="../../_images/sphx_glr_plot_5_resilience_cls_007.png" src="../../_images/sphx_glr_plot_5_resilience_cls_007.png" /></a>
</figure>
</section>
<section id="marginal-density-comparison">
<h3><span class="section-number">6.6.2.3. </span>Marginal Density Comparison<a class="headerlink" href="#marginal-density-comparison" title="Permalink to this heading">Â¶</a></h3>
<p>The marginal density plot that shows the distributional difference of the worst test samples and full test samples for a single feature. To generate this plot, set <code class="docutils literal notranslate"><span class="pre">show</span></code> to âresilience_shift_densityâ, and also specify the <code class="docutils literal notranslate"><span class="pre">target_feature</span></code> to be plotted.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_diagnose</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;resilience_shift_density&quot;</span><span class="p">,</span>
                                <span class="n">target_feature</span><span class="o">=</span><span class="s2">&quot;Pay_1&quot;</span><span class="p">,</span> <span class="n">original_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/testing/plot_5_resilience_cls.html"><img alt="../../_images/sphx_glr_plot_5_resilience_cls_008.png" src="../../_images/sphx_glr_plot_5_resilience_cls_008.png" /></a>
</figure>
</section>
<section id="marginal-histogram-comparison">
<h3><span class="section-number">6.6.2.4. </span>Marginal Histogram Comparison<a class="headerlink" href="#marginal-histogram-comparison" title="Permalink to this heading">Â¶</a></h3>
<p>Similar to the density plot, we also provide the option to draw the histogram comparison of the worst test samples and full test samples for a single feature, by using the keyword âresilience_shift_histogramâ.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_diagnose</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;resilience_shift_histogram&quot;</span><span class="p">,</span>
                                <span class="n">target_feature</span><span class="o">=</span><span class="s2">&quot;Pay_1&quot;</span><span class="p">,</span> <span class="n">original_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/testing/plot_5_resilience_cls.html"><img alt="../../_images/sphx_glr_plot_5_resilience_cls_009.png" src="../../_images/sphx_glr_plot_5_resilience_cls_009.png" /></a>
</figure>
</section>
</section>
<section id="examples">
<h2><span class="section-number">6.6.3. </span>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">Â¶</a></h2>
<aside class="topic">
<p class="topic-title">Example 1: CaliforniaHousing</p>
<p>The example below demonstrates how to use PiML with its high-code APis for the California Housing dataset from the UCI repository, which consists of 20,640 samples and 9 features, fetched by sklearn.datasets. The response variable MedHouseVal (Median Home Value) is continuous and is a regression problem.</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../../auto_examples/testing/plot_5_resilience_reg.html#sphx-glr-auto-examples-testing-plot-5-resilience-reg-py"><span class="std std-ref">Resilience - Regression</span></a></p></li>
</ul>
</div></blockquote>
</aside>
<aside class="topic">
<p class="topic-title">Examples 2: Taiwan Credit</p>
<p>The second example below demonstrates how to use PiMLâs high-code APIs for the TaiwanCredit dataset from the UCI repository. This dataset comprises the credit card details of 30,000 clients in Taiwan from April 2005 to September 2005, and more information can be found on the TaiwanCreditData website. The <code class="docutils literal notranslate"><span class="pre">FlagDefault</span></code> variable serves as the response for this classification problem.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../auto_examples/testing/plot_5_resilience_cls.html#sphx-glr-auto-examples-testing-plot-5-resilience-cls-py"><span class="std std-ref">Resilience:  Classification</span></a></p></li>
</ul>
</aside>
</section>
</section>


        </div>
      <div class="container">
        <footer class="sk-content-footer">
              &copy; Copyright 2022-, PiML-Toolbox authors.
            <a href="../../_sources/guides/testing/resilience.rst.txt" rel="nofollow">Show this page source</a>
        </footer>
      </div>
    </div>
  </div>


  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
      
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
  </script>

<script>
$(document).ready(function() {
    /* Add a [>>>] button on the top-right corner of code samples to hide
     * the >>> and ... prompts and the output and thus make the code
     * copyable. */
    var div = $('.highlight-python .highlight,' +
                '.highlight-python3 .highlight,' +
                '.highlight-pycon .highlight,' +
		'.highlight-default .highlight')
    var pre = div.find('pre');

    // get the styles from the current theme
    pre.parent().parent().css('position', 'relative');
    var hide_text = 'Hide prompts and outputs';
    var show_text = 'Show prompts and outputs';

    // create and add the button to all the code blocks that contain >>>
    div.each(function(index) {
        var jthis = $(this);
        if (jthis.find('.gp').length > 0) {
            var button = $('<span class="copybutton">&gt;&gt;&gt;</span>');
            button.attr('title', hide_text);
            button.data('hidden', 'false');
            jthis.prepend(button);
        }
        // tracebacks (.gt) contain bare text elements that need to be
        // wrapped in a span to work with .nextUntil() (see later)
        jthis.find('pre:has(.gt)').contents().filter(function() {
            return ((this.nodeType == 3) && (this.data.trim().length > 0));
        }).wrap('<span>');
    });

    // define the behavior of the button when it's clicked
    $('.copybutton').click(function(e){
        e.preventDefault();
        var button = $(this);
        if (button.data('hidden') === 'false') {
            // hide the code output
            button.parent().find('.go, .gp, .gt').hide();
            button.next('pre').find('.gt').nextUntil('.gp, .go').css('visibility', 'hidden');
            button.css('text-decoration', 'line-through');
            button.attr('title', show_text);
            button.data('hidden', 'true');
        } else {
            // show the code output
            button.parent().find('.go, .gp, .gt').show();
            button.next('pre').find('.gt').nextUntil('.gp, .go').css('visibility', 'visible');
            button.css('text-decoration', 'none');
            button.attr('title', hide_text);
            button.data('hidden', 'false');
        }
    });

	/*** Add permalink buttons next to glossary terms ***/
	$('dl.glossary > dt[id]').append(function() {
		return ('<a class="headerlink" href="#' +
			    this.getAttribute('id') +
			    '" title="Permalink to this term">Â¶</a>');
	});
  /*** Hide navbar when scrolling down ***/
  // Returns true when headerlink target matches hash in url
  (function() {
    hashTargetOnTop = function() {
        var hash = window.location.hash;
        if ( hash.length < 2 ) { return false; }

        var target = document.getElementById( hash.slice(1) );
        if ( target === null ) { return false; }

        var top = target.getBoundingClientRect().top;
        return (top < 2) && (top > -2);
    };

    // Hide navbar on load if hash target is on top
    var navBar = document.getElementById("navbar");
    var navBarToggler = document.getElementById("sk-navbar-toggler");
    var navBarHeightHidden = "-" + navBar.getBoundingClientRect().height + "px";
    var $window = $(window);

    hideNavBar = function() {
        navBar.style.top = navBarHeightHidden;
    };

    showNavBar = function() {
        navBar.style.top = "0";
    }

    if (hashTargetOnTop()) {
        hideNavBar()
    }

    var prevScrollpos = window.pageYOffset;
    hideOnScroll = function(lastScrollTop) {
        if (($window.width() < 768) && (navBarToggler.getAttribute("aria-expanded") === 'true')) {
            return;
        }
        if (lastScrollTop > 2 && (prevScrollpos <= lastScrollTop) || hashTargetOnTop()){
            hideNavBar()
        } else {
            showNavBar()
        }
        prevScrollpos = lastScrollTop;
    };

    /*** high performance scroll event listener***/
    var raf = window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        window.oRequestAnimationFrame;
    var lastScrollTop = $window.scrollTop();

    if (raf) {
        loop();
    }

    function loop() {
        var scrollTop = $window.scrollTop();
        if (lastScrollTop === scrollTop) {
            raf(loop);
            return;
        } else {
            lastScrollTop = scrollTop;
            hideOnScroll(lastScrollTop);
            raf(loop);
        }
    }
  })();
});

</script>
    

<script src="_static/js/vendor/bootstrap.min.js"></script>

</body>
</html>